<!doctype html>
<html lang="zh-Hans" dir="ltr" class="blog-wrapper blog-post-page plugin-blog plugin-id-default">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.2.0">
<title data-rh="true">基于 Zipkin 和 OpenTelemetry Java Agent 实现系统调用链路跟踪 | 程序员老熊的博客网站®</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://xiongchun.github.io/blog/observability/zipkin-opentelemetry-java-agent-tracing-quickstart"><meta data-rh="true" name="docusaurus_locale" content="zh-Hans"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="zh-Hans"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" name="author" content="程序员老熊 熊春"><meta data-rh="true" name="keywords" content="程序员老熊 Xiong Chun 熊春 一个爱生活爱编程的程序员 盘古开发框架 Datacollie Java JavaFX Python"><meta data-rh="true" name="baidu-site-verification" content="code-umYMvMmkhO"><meta data-rh="true" property="og:title" content="基于 Zipkin 和 OpenTelemetry Java Agent 实现系统调用链路跟踪 | 程序员老熊的博客网站®"><meta data-rh="true" name="description" content="本文介绍如何基于 Zipkin 和 OpenTelemetry Java Agent 搭架一个分布式链路调用跟踪的系统。它可以帮助我们有效收集一个请求调用链路过程并对链路节点数据进行分析和查找。可以结合 TraceID 和 Log 系统对问题根因进行溯源。同类竞品还有 Uber 开源的 Jaeger，感兴趣的同学可以自行研究。"><meta data-rh="true" property="og:description" content="本文介绍如何基于 Zipkin 和 OpenTelemetry Java Agent 搭架一个分布式链路调用跟踪的系统。它可以帮助我们有效收集一个请求调用链路过程并对链路节点数据进行分析和查找。可以结合 TraceID 和 Log 系统对问题根因进行溯源。同类竞品还有 Uber 开源的 Jaeger，感兴趣的同学可以自行研究。"><meta data-rh="true" property="og:type" content="article"><meta data-rh="true" property="article:published_time" content="2023-07-16T00:00:00.000Z"><meta data-rh="true" property="article:author" content="https://xiongchun.github.io"><meta data-rh="true" property="article:tag" content="可观测性,服务端开发"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://xiongchun.github.io/blog/observability/zipkin-opentelemetry-java-agent-tracing-quickstart"><link data-rh="true" rel="alternate" href="https://xiongchun.github.io/blog/observability/zipkin-opentelemetry-java-agent-tracing-quickstart" hreflang="zh-Hans"><link data-rh="true" rel="alternate" href="https://xiongchun.github.io/blog/observability/zipkin-opentelemetry-java-agent-tracing-quickstart" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="程序员老熊的博客网站® RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="程序员老熊的博客网站® Atom Feed"><link rel="stylesheet" href="/assets/css/styles.3be9e9e4.css">
<link rel="preload" href="/assets/js/runtime~main.1c68365b.js" as="script">
<link rel="preload" href="/assets/js/main.f846d158.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="跳到主要内容"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">跳到主要内容</a></div><nav class="navbar navbar--fixed-top navbarHideable_m1mJ"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="程序员老熊博客网站" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/logo.svg" alt="程序员老熊博客网站" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">程序员老熊博客®</b></a></div><div class="navbar__items navbar__items--right"><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/blog/">文章</a><a class="navbar__item navbar__link" href="/blog/archive/">归档</a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">开源作品</a><ul class="dropdown__menu"><li><a href="https://xiongchun.github.io/pangu-framework/" target="_blank" rel="noopener noreferrer" class="dropdown__link">盘古开发框架</a></li><li><a class="dropdown__link" href="/blog/aosuite-eol/">AOSuite 开发平台 [EOL]</a></li></ul></div><a class="navbar__item navbar__link" href="/about">关于</a><a href="https://github.com/xiongchun" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link"></a><a href="https://gitee.com/xiong-chun" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-gitee-link"></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="切换浅色/暗黑模式（当前为浅色模式）" aria-label="切换浅色/暗黑模式（当前为浅色模式）" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><div class="navbar__search searchBarContainer_NW3z"><input placeholder="搜索" aria-label="Search" class="navbar__search-input"><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><main class="col col--9 col--offset-1" itemscope="" itemtype="http://schema.org/Blog"><article itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h1 class="title_f1Hy" itemprop="headline">基于 Zipkin 和 OpenTelemetry Java Agent 实现系统调用链路跟踪</h1><div class="container_mt6G margin-vert--md"><time datetime="2023-07-16T00:00:00.000Z" itemprop="datePublished">2023年7月16日</time> · <!-- -->阅读需 5 分钟</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://xiongchun.github.io" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://xiongchun.github.io/img/xiongchun.jpg" alt="程序员老熊"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://xiongchun.github.io" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">程序员老熊</span></a></div><small class="avatar__subtitle" itemprop="description">Pangu Framework maintainer</small></div></div></div></div></header><div id="post-content" class="markdown" itemprop="articleBody"><p>本文介绍如何基于 <a href="https://github.com/openzipkin/zipkin" target="_blank" rel="noopener noreferrer">Zipkin</a> 和 <a href="https://github.com/open-telemetry/opentelemetry-java-instrumentation" target="_blank" rel="noopener noreferrer">OpenTelemetry Java Agent</a> 搭架一个分布式链路调用跟踪的系统。它可以帮助我们有效收集一个请求调用链路过程并对链路节点数据进行分析和查找。可以结合 TraceID 和 Log 系统对问题根因进行溯源。同类竞品还有 Uber 开源的 <a href="https://www.jaegertracing.io/" target="_blank" rel="noopener noreferrer">Jaeger</a>，感兴趣的同学可以自行研究。</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="背景">背景<a class="hash-link" href="#背景" title="标题的直接链接">​</a></h2><p>当前大部分系统都基于微服务模式开发，调用关系复杂多变，Observability（可观测性）就显得尤为重要。Observabilit 能让我们清晰的感知到系统当前的运行状态以及它曾经发生了什么。当有故障发生时，我们也可以借助 Observabilit 系统有效的快速定位问题根因并完成修复（这点尤其重要）。Observabilit 主要包括 traces、metrics 和 logs。今天，我们主要讨论 <strong>traces</strong>。</p><blockquote><p>业界把 Observability 翻译为 “可观测性”，本人略感生硬。本站相关文档将直接使用 Observability 单词，不再做中文对照翻译。</p></blockquote><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="zipkin-系统架构图">Zipkin 系统架构图<a class="hash-link" href="#zipkin-系统架构图" title="标题的直接链接">​</a></h2><p>想要看明白 Zipkin 的全貌和工作原理，我们必须搞一个架构图出来。如下图所示。</p><img loading="lazy" width="600" src="/assets/images/54-zipkin-c6f5eb7a22f8ee8c0f9b7a15c4bdd3d3.png" alt="Zipkin系统架构图" class="img_ev3q"><div class="theme-admonition theme-admonition-info alert alert--info admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>看图说话</div><div class="admonitionContent_S0QG"><p>The component in an instrumented app that sends data to Zipkin is called a Exporter. Exporter send trace data via one of several transports to Zipkin collectors, which persist trace data to storage. Later, storage is queried by the API to provide data to the UI.</p></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="exporter">Exporter<a class="hash-link" href="#exporter" title="标题的直接链接">​</a></h4><p>指通过Agent或者SDK方式嵌入到了应用中采集并向 Collector 发送 Telemetry 数据能力的组件。Telemetry Data (traces、metrics 和 logs) 数据通过这个 Exporter 发送出去。</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="transport">Transport<a class="hash-link" href="#transport" title="标题的直接链接">​</a></h4><p>主要支持三种遥测数据传输模式。HTTP、MQ（ActiveMQ、Kafka、RabbitMQ）、Scribe（NettyScribeServer）。</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="collector">Collector<a class="hash-link" href="#collector" title="标题的直接链接">​</a></h4><p>Once the trace data arrives at the Zipkin collector daemon, it is validated, stored, and indexed for lookups by the Zipkin collector.</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="storage">Storage<a class="hash-link" href="#storage" title="标题的直接链接">​</a></h4><p>数据存储方案。目前支持 4 种。内存模式、MySQL、ElasticSearch、Cassandra。后期有可能会支持 ClickHouse。内存模式只能用于开发测试、MySQL模式也只能用于开发测试和小规模生产体验。</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="apiquery-service">API（Query Service）<a class="hash-link" href="#apiquery-service" title="标题的直接链接">​</a></h4><p>Once the data is stored and indexed, we need a way to extract it. The query daemon provides a simple JSON API for finding and retrieving traces. The primary consumer of this API is the Web UI.</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="webui">WebUI<a class="hash-link" href="#webui" title="标题的直接链接">​</a></h4><p>The web UI provides a method for viewing traces based on service, time, and annotations.</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="安装-zipkin-服务端">安装 Zipkin 服务端<a class="hash-link" href="#安装-zipkin-服务端" title="标题的直接链接">​</a></h2><div class="tabs-container tabList__CuJ"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_LNqP tabs__item--active">Java</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">Docker</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">Running from Source</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_Ymn6"><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">curl</span><span class="token plain"> -sSL https://zipkin.io/quickstart.sh </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">bash</span><span class="token plain"> -s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">java -jar zipkin.jar</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> run -d -p </span><span class="token number" style="color:#36acaa">9411</span><span class="token plain">:9411 openzipkin/zipkin</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># get the latest source</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">git</span><span class="token plain"> clone https://github.com/openzipkin/zipkin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">cd</span><span class="token plain"> zipkin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Build the server and also make its dependencies</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">./mvnw -DskipTests --also-make -pl zipkin-server clean </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Run the server</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">java -jar ./zipkin-server/target/zipkin-server-*exec.jar</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></div><p>为了快速体验，我们使用第一种安装方式：<code>java -jar zipkin.jar</code> 直接启动。这种模式是以内存存储你是启动的，不需要配置后端存储方案。启动后访问：<a href="http://127.0.0.1:9411/zipkin" target="_blank" rel="noopener noreferrer">http://127.0.0.1:9411/zipkin</a>。</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="安装-exporter">安装 Exporter<a class="hash-link" href="#安装-exporter" title="标题的直接链接">​</a></h2><p>基于 OpenTelemetry Automatic Instrumentation 模式为例实现业务系统的数据遥测数据采集。</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="下载-agent-安装包">下载 Agent 安装包<a class="hash-link" href="#下载-agent-安装包" title="标题的直接链接">​</a></h4><p>从 opentelemetry-java-instrumentation 官方版本发布页面找到最新的安装包下载。<a href="https://github.com/open-telemetry/opentelemetry-java-instrumentation/releases" target="_blank" rel="noopener noreferrer">opentelemetry-javaagent.jar
</a></p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="将-agent-挂载的业务应用上并启动">将 Agent 挂载的业务应用上并启动<a class="hash-link" href="#将-agent-挂载的业务应用上并启动" title="标题的直接链接">​</a></h4><div class="language-jsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">java </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">javaagent</span><span class="token operator" style="color:#393A34">:</span><span class="token operator" style="color:#393A34">/</span><span class="token maybe-class-name">Users</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">xc</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">apps</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">agent</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">opentelemetry</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">javaagent</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">jar</span><span class="token plain"> \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     </span><span class="token operator" style="color:#393A34">-</span><span class="token maybe-class-name">Dotel</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">service</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">name</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">your</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">service</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">name \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     </span><span class="token operator" style="color:#393A34">-</span><span class="token maybe-class-name">Dotel</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">traces</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">exporter</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">zipkin \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     </span><span class="token operator" style="color:#393A34">-</span><span class="token maybe-class-name">Dotel</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">exporter</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">zipkin</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">endpoint</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">http</span><span class="token operator" style="color:#393A34">:</span><span class="token operator" style="color:#393A34">/</span><span class="token operator" style="color:#393A34">/</span><span class="token number" style="color:#36acaa">127.0</span><span class="token number" style="color:#36acaa">.0</span><span class="token number" style="color:#36acaa">.1</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">9411</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">api</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">v2</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">spans \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">jar myapp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">jar</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><blockquote><p>上述配置是通过 http 协议的方式来采集 Trace 数据，但实际生产环境建议使用 MQ 方式来采集。相关配置查阅 Zipkin 文档。</p></blockquote><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="无图无真相">无图无真相<a class="hash-link" href="#无图无真相" title="标题的直接链接">​</a></h2><p>完成如上配置后，当我们操作业务系统就会有相应的链路跟踪数据进入到Zipkin。如下图所示：</p><p><img loading="lazy" alt="Zipkin分布式链路跟踪图" src="/assets/images/55-zipkin-4a1aec117444e8d522765fef3506fd52.png" width="2874" height="1576" class="img_ev3q"></p></div><footer class="row docusaurus-mt-lg blogPostFooterDetailsFull_mRVl"><div class="col"><b>标签：</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/可观测性">可观测性</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/服务端开发">服务端开发</a></li></ul></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="博文分页导航"><a class="pagination-nav__link pagination-nav__link--prev" href="/blog/dubbo/triple/stream_push"><div class="pagination-nav__sublabel">较新一篇</div><div class="pagination-nav__label">基于 Dubbo3 的 Triple 协议实现消息的流式通信</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/blog/pangu-dev-framework-distributed-transaction"><div class="pagination-nav__sublabel">较旧一篇</div><div class="pagination-nav__label">基于 Seata AT 模式的分布式事务落地方案</div></a></nav></main><div class="col col--2"><div class="tableOfContents_bqdL thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#背景" class="table-of-contents__link toc-highlight">背景</a></li><li><a href="#zipkin-系统架构图" class="table-of-contents__link toc-highlight">Zipkin 系统架构图</a></li><li><a href="#安装-zipkin-服务端" class="table-of-contents__link toc-highlight">安装 Zipkin 服务端</a></li><li><a href="#安装-exporter" class="table-of-contents__link toc-highlight">安装 Exporter</a></li><li><a href="#无图无真相" class="table-of-contents__link toc-highlight">无图无真相</a></li></ul></div></div></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 程序员老熊博客网站® &nbsp; <a class="ghostwhite" href="https://beian.miit.gov.cn/" target="_blank">滇ICP备2022001611号-1</a></div></div></div></footer></div>
<script src="/assets/js/runtime~main.1c68365b.js"></script>
<script src="/assets/js/main.f846d158.js"></script>
</body>
</html>